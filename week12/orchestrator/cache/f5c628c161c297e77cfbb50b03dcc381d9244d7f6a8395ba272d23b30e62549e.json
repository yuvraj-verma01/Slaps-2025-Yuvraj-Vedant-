{
  "prompt": "You are a Dafny assistant. Given Python source, a drafted Dafny translation, and metadata, produce a JSON patch that improves specifications (requires/ensures), types, loop invariants, and decreases. Follow the rules strictly.\n\nInputs:\n- Python source:\ndef sum_squares(n: int):\n    i = 0\n    s = 0\n    while i < n:\n        s = s + 2*i + 1\n        i = i + 1\n    return s\n\n\n- Draft Dafny:\nmodule sum_squares\n{\n  method sum_squares(n: int) returns (ret: int)\n    decreases *  // @method_dec_star_if_needed\n    // @requires_placeholder\n    // @ensures_placeholder\n  {\n    var i: int := 0;\n    var s: int := 0;\n    while ((i < n))\n    // @loop_id:0\n    invariant true // @inv_placeholder:0\n    decreases * // @dec_placeholder:0;\n    {\n      s := ((s + (2 * i)) + 1);\n      i := (i + 1);\n    }\n    ret := s;\n    return;\n  }\n\n}\n\n- Metadata (loops/vars):\n{\n  \"module\": \"sum_squares\",\n  \"functions\": [\n    {\n      \"name\": \"sum_squares\",\n      \"params\": [\n        {\n          \"name\": \"n\",\n          \"type_guess\": \"int\"\n        }\n      ],\n      \"ret\": {\n        \"name\": \"ret\",\n        \"type_guess\": \"int\"\n      },\n      \"loops\": [\n        {\n          \"loop_id\": 0,\n          \"kind\": \"while\",\n          \"condition\": \"(i < n)\",\n          \"vars_in_condition\": [\n            \"i\",\n            \"n\"\n          ],\n          \"vars_modified\": [\n            \"i\",\n            \"s\"\n          ],\n          \"has_mutation\": false,\n          \"vars_in_scope\": [\n            {\n              \"name\": \"i\",\n              \"type_guess\": \"int\"\n            },\n            {\n              \"name\": \"n\",\n              \"type_guess\": \"int\"\n            },\n            {\n              \"name\": \"ret\",\n              \"type_guess\": \"int\"\n            },\n            {\n              \"name\": \"s\",\n              \"type_guess\": \"int\"\n            }\n          ]\n        }\n      ],\n      \"unsupported\": []\n    }\n  ]\n}\n\nPatch format (JSON only):\n{\n  \"requires\": [ ... ],\n  \"ensures\": [ ... ],\n  \"types\": { \"var_or_param\": \"dafny_type\" },\n  \"rewrites\": [ {\"from\": \"len(a)\", \"to\": \"|a|\"}, {\"from\": \"True\", \"to\": \"true\"}, {\"from\": \"False\", \"to\": \"false\"} ],\n  \"loops\": [\n    { \"loop_id\": 0, \"invariants\": [ ... ], \"decreases\": \"...\" }\n  ]\n}\n\nRules:\n- Output JSON only. No code fences, no prose.\n- Use only variables in scope per metadata.\n- Prefer inductive invariants; if unsure, leave invariants empty.\n- Use Dafny syntax: |a| for length, &&, ||, !, ==> for implication.\n- If unsure about decreases, leave null/omit; otherwise provide a well-founded expression.\n- Keep rewrites minimal; do not introduce new identifiers.\n- Do not restate the full program; only fill the patch fields.\n",
  "response": "{\n  \"requires\": [\"n >= 0\"],\n  \"ensures\": [\"ret == n * n\"],\n  \"types\": {\n    \"n\": \"int\",\n    \"ret\": \"int\",\n    \"i\": \"int\",\n    \"s\": \"int\"\n  },\n  \"rewrites\": [],\n  \"loops\": [\n    {\n      \"loop_id\": 0,\n      \"invariants\": [\n        \"s == i * i\",\n        \"0 <= i && i <= n\"\n      ],\n      \"decreases\": \"n - i\"\n    }\n  ]\n}",
  "model": "openai/gpt-oss-120b",
  "backend": "openrouter"
}